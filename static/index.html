<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>ü§ñ TurtleBot App Store</title>
  <style>
    body { margin:0; font-family:sans-serif; background:#0d1117; }
    .navbar { display:flex; justify-content:space-between; align-items:center; padding:10px 30px; background:#21262d; box-shadow:0 2px 4px rgba(0,0,0,0.4); position:sticky; top:0; }
    .nav-tabs { display:flex; gap:24px; }
    .nav-tab { cursor:pointer; padding:8px 0; border-bottom:3px solid transparent; color:#e6edf3; }
    .nav-tab.active { border-color:#58a6ff; color:#58a6ff; }
    .user-dropdown { position:relative; display:inline-block; }
    .user-label { background:#58a6ff; color:#21262d; padding:6px 12px; border-radius:6px; cursor:pointer; }
    .dropdown-content {
      display: none; position: absolute; right: 0; background: #21262d;
      min-width: 120px; box-shadow: 0px 8px 16px rgba(0,0,0,0.2); border-radius: 6px;
    }
    .dropdown-content div {
      padding: 10px; cursor: pointer;
    }
    .dropdown-content div:hover {
      background-color: #30363d;
    }
    .user-dropdown:hover .dropdown-content { display: block; }
    .view { display:none; padding:30px; }
    .card-grid {
      display:grid;
      gap:20px;
      grid-template-columns:repeat(auto-fill,minmax(200px,1fr));
    }
    .app-card {
      background:#21262d;
      padding:16px;
      border-radius:10px;
      text-align:center;
      box-shadow:0 2px 6px rgba(0,0,0,0.05);
      cursor:pointer;
      transition: all 0.2s;
    }
    .app-card:hover { background:#eef7ff; }
    .app-card img { width:64px; height:64px; margin-bottom:10px; }

    /* Enhanced Installed Apps Styles */
    .installed-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      background: #21262d;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
    }

    .installed-title {
      margin: 0;
      font-size: 1.8em;
      font-weight: bold;
      color: #e6edf3;
    }

    .installed-stats {
      display: flex;
      gap: 30px;
      align-items: center;
    }

    .stat-item {
      text-align: center;
    }

    .stat-number {
      font-size: 1.5em;
      font-weight: bold;
      color: #58a6ff;
      display: block;
    }

    .stat-label {
      font-size: 0.9em;
      color: #666;
      margin-top: 2px;
    }

    .installed-controls {
      display: flex;
      gap: 15px;
      margin-bottom: 20px;
      align-items: center;
    }

    .search-installed {
      flex: 1;
      max-width: 400px;
      padding: 10px 15px;
      border: 1px solid #30363d;
      border-radius: 8px;
      font-size: 14px;
    }

    .filter-dropdown {
      padding: 10px 15px;
      border: 1px solid #30363d;
      border-radius: 8px;
      background: #21262d;
      cursor: pointer;
      min-width: 120px;
    }

    .bulk-actions {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .bulk-btn {
      padding: 8px 16px;
      border: 1px solid #30363d;
      border-radius: 6px;
      background: #21262d;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.2s;
    }

    .bulk-btn:hover {
      background: #0d1117;
      border-color: #58a6ff;
    }

    .bulk-btn.danger {
      border-color: #dc3545;
      color: #dc3545;
    }

    .bulk-btn.danger:hover {
      background: #dc3545;
      color: #21262d;
    }

    .installed-apps-grid {
      display: grid;
      gap: 15px;
    }

    .installed-app-card {
      background: #21262d;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
      display: grid;
      grid-template-columns: auto 1fr auto auto;
      gap: 20px;
      align-items: center;
      transition: all 0.2s;
      cursor: pointer;
    }

    .installed-app-card:hover {
      box-shadow: 0 4px 12px rgba(0,0,0,0.4);
      transform: translateY(-1px);
    }

    .app-checkbox {
      width: 18px;
      height: 18px;
      cursor: pointer;
    }

    .installed-app-info {
      display: flex;
      gap: 15px;
      align-items: center;
      flex: 1;
    }

    .installed-app-icon {
      width: 48px;
      height: 48px;
      border-radius: 8px;
      flex-shrink: 0;
    }

    .installed-app-details {
      flex: 1;
    }

    .installed-app-name {
      font-size: 1.1em;
      font-weight: 600;
      color: #e6edf3;
      margin: 0 0 5px 0;
    }

    .installed-app-description {
      color: #666;
      font-size: 0.9em;
      margin: 0 0 8px 0;
      line-height: 1.4;
    }

    .installed-app-meta {
      display: flex;
      gap: 15px;
      font-size: 0.8em;
      color: #999;
    }

    .meta-item {
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .installed-app-actions {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .action-btn {
      padding: 6px 12px;
      border: 1px solid #30363d;
      border-radius: 6px;
      background: #21262d;
      cursor: pointer;
      font-size: 12px;
      transition: all 0.2s;
      text-decoration: none;
      color: #e6edf3;
    }

    .action-btn:hover {
      background: #0d1117;
      border-color: #58a6ff;
      color: #58a6ff;
    }

    .action-btn.uninstall {
      border-color: #dc3545;
      color: #dc3545;
    }

    .action-btn.uninstall:hover {
      background: #dc3545;
      color: #21262d;
    }

    .action-btn.launch {
      border-color: #28a745;
      color: #28a745;
    }

    .action-btn.launch:hover {
      background: #28a745;
      color: #21262d;
    }

    .installed-app-size {
      font-size: 0.9em;
      color: #666;
      font-weight: 500;
      min-width: 60px;
      text-align: right;
    }

    .no-apps-message {
      text-align: center;
      padding: 60px 20px;
      background: #21262d;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
    }

    .no-apps-icon {
      font-size: 4em;
      color: #30363d;
      margin-bottom: 20px;
    }

    .no-apps-text {
      font-size: 1.2em;
      color: #666;
      margin-bottom: 10px;
    }

    .no-apps-subtext {
      color: #999;
      margin-bottom: 30px;
    }

    .browse-apps-btn {
      background: #58a6ff;
      color: #21262d;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      font-weight: 500;
      transition: background-color 0.2s;
    }

    .browse-apps-btn:hover {
      background: #1f6feb;
    }

    /* Enhanced Robot Management Styles */
    .robot-card {
      background:#21262d;
      padding:20px;
      border-radius:10px;
      box-shadow:0 2px 6px rgba(0,0,0,0.05);
      margin-bottom:15px;
      cursor:pointer;
      transition: all 0.2s;
      border-left: 4px solid transparent;
    }
    .robot-card:hover { 
      background:#f0f8ff; 
      box-shadow: 0 4px 12px rgba(0,0,0,0.4);
      transform: translateY(-2px);
      border-left-color: #58a6ff;
    }
    .robot-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }
    .robot-title { 
      font-size:1.3em; 
      font-weight:bold; 
      color:#e6edf3; 
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .robot-subtitle { 
      color:#666; 
      font-size:0.95em; 
      margin-bottom: 15px;
      display: flex;
      gap: 20px;
      align-items: center;
    }
    .status-badge { padding:6px 12px; border-radius:16px; font-size:0.8em; font-weight:bold; }
    .status-active { background:#d4edda; color:#155724; }
    .status-inactive { background:#f8d7da; color:#721c24; }

    .robot-type-icon {
      font-size: 1.5em;
      margin-right: 8px;
    }

    .robot-actions-bar {
      display: flex;
      gap: 10px;
      justify-content: flex-end;
      margin-top: 15px;
      padding-top: 15px;
      border-top: 1px solid #eee;
    }

    /* Multi-Robot Panel Styles */
    .multi-robot-panel {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #21262d;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
      margin: 20px 0;
    }

    .multi-robot-panel h3 {
      margin: 0 0 15px 0;
      font-size: 1.4em;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .multi-robot-stats {
      display: flex;
      gap: 30px;
      align-items: center;
      margin-bottom: 20px;
    }

    .multi-stat-item {
      text-align: center;
    }

    .multi-stat-number {
      font-size: 2em;
      font-weight: bold;
      display: block;
    }

    .multi-stat-label {
      font-size: 0.9em;
      opacity: 0.9;
    }

    .multi-robot-controls {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
    }

    .multi-btn {
      background: rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.3);
      color: #21262d;
      padding: 12px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s;
    }

    .multi-btn:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    .multi-btn.primary {
      background: rgba(40, 167, 69, 0.8);
      border-color: #28a745;
    }

    .multi-btn.primary:hover {
      background: #28a745;
    }

    /* Enhanced Add Robot Page Styles */
    .add-robot-container {
      max-width: 1000px;
      margin: 0 auto;
    }

    .add-robot-header {
      background: #21262d;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
      margin-bottom: 30px;
      text-align: center;
    }

    .add-robot-title {
      font-size: 2.2em;
      font-weight: bold;
      color: #e6edf3;
      margin: 0 0 15px 0;
    }

    .add-robot-subtitle {
      color: #666;
      font-size: 1.1em;
      margin: 0;
    }

    .robot-type-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 20px;
      margin-bottom: 40px;
    }

    .robot-type-card {
      background: #21262d;
      border: 2px solid #e9ecef;
      border-radius: 12px;
      padding: 25px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .robot-type-card:hover {
      border-color: #58a6ff;
      background: #f8f9ff;
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(0,123,255,0.15);
    }

    .robot-type-card.active {
      border-color: #58a6ff;
      background: #e3f2fd;
    }

    .robot-type-icon {
      font-size: 3em;
      margin-bottom: 15px;
      display: block;
    }

    .robot-type-name {
      font-size: 1.3em;
      font-weight: bold;
      color: #e6edf3;
      margin-bottom: 8px;
    }

    .robot-type-description {
      color: #666;
      font-size: 0.9em;
      line-height: 1.4;
      margin-bottom: 15px;
    }

    .robot-type-features {
      list-style: none;
      padding: 0;
      margin: 0;
      text-align: left;
    }

    .robot-type-features li {
      color: #555;
      font-size: 0.8em;
      padding: 3px 0;
      position: relative;
      padding-left: 15px;
    }

    .robot-type-features li:before {
      content: "‚úì";
      color: #28a745;
      font-weight: bold;
      position: absolute;
      left: 0;
    }

    .robot-form-container {
      background: #21262d;
      border-radius: 12px;
      padding: 30px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
      margin-top: 20px;
      display: none;
    }

    .robot-form-container.active {
      display: block;
      animation: slideDown 0.3s ease;
    }

    @keyframes slideDown {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .robot-form-header {
      text-align: center;
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 1px solid #eee;
    }

    .robot-form-title {
      font-size: 1.8em;
      font-weight: bold;
      color: #e6edf3;
      margin: 0 0 8px 0;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
    }

    .robot-form-subtitle {
      color: #666;
      font-size: 1em;
    }

    .form-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 25px;
      margin-bottom: 30px;
    }

    .form-field {
      margin: 0;
    }

    .form-field.full-width {
      grid-column: 1 / -1;
    }

    .form-field label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #e6edf3;
      font-size: 0.95em;
    }

    .form-field input, 
    .form-field select {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid #e9ecef;
      border-radius: 8px;
      font-size: 14px;
      transition: border-color 0.2s;
      box-sizing: border-box;
    }

    .form-field input:focus, 
    .form-field select:focus {
      outline: none;
      border-color: #58a6ff;
    }

    .form-actions {
      display: flex;
      gap: 15px;
      justify-content: center;
      margin-top: 30px;
      padding-top: 20px;
      border-top: 1px solid #eee;
    }

    .btn-primary {
      background: #58a6ff;
      color: #21262d;
      border: none;
      padding: 12px 30px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      font-weight: 600;
      transition: background-color 0.2s;
    }

    .btn-primary:hover {
      background: #1f6feb;
    }

    .btn-secondary {
      background: #6c757d;
      color: #21262d;
      border: none;
      padding: 12px 30px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      font-weight: 600;
      transition: background-color 0.2s;
    }

    .btn-secondary:hover {
      background: #545b62;
    }

    /* Enhanced Robot Detail Page Styles */
    .robot-detail-container { 
      max-width: 1200px; 
      margin: 0 auto;
    }

    .robot-detail-header {
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 30px;
      background: #21262d;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
      margin-bottom: 30px;
      position: relative;
      overflow: hidden;
    }

    .robot-detail-header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, #58a6ff, #1f6feb);
    }

    .robot-info { 
      flex: 1; 
    }

    .robot-name { 
      font-size: 2.2em; 
      font-weight: bold; 
      color: #e6edf3; 
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .robot-details { 
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 25px; 
      margin-bottom: 20px;
    }

    .detail-item { 
      background: #0d1117;
      padding: 15px;
      border-radius: 8px;
      border-left: 4px solid #58a6ff;
    }

    .detail-label { 
      font-size: 0.85em; 
      color: #666; 
      margin-bottom: 5px;
      text-transform: uppercase;
      font-weight: 600;
      letter-spacing: 0.5px;
    }

    .detail-value { 
      font-weight: bold; 
      color: #e6edf3;
      font-size: 1.1em;
    }

    .robot-actions { 
      display: flex; 
      gap: 15px;
      align-items: flex-start;
    }

    .btn-gazebo {
      background: linear-gradient(135deg, #28a745, #20c997);
      color: #21262d;
      border: none;
      padding: 12px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
      transition: all 0.2s;
      box-shadow: 0 2px 4px rgba(40, 167, 69, 0.3);
    }

    .btn-gazebo:hover { 
      background: linear-gradient(135deg, #218838, #1ea087);
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(40, 167, 69, 0.4);
    }

    .btn-delete {
      background: linear-gradient(135deg, #dc3545, #c82333);
      color: #21262d;
      border: none;
      padding: 12px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
      transition: all 0.2s;
      box-shadow: 0 2px 4px rgba(220, 53, 69, 0.3);
    }

    .btn-delete:hover { 
      background: linear-gradient(135deg, #c82333, #a71e2a);
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(220, 53, 69, 0.4);
    }

    .robot-stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .robot-specs {
      background: #21262d;
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
    }

    .specs-title { 
      font-size: 1.4em; 
      font-weight: bold; 
      margin-bottom: 20px; 
      color: #e6edf3;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .specs-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
    }

    .spec-item { 
      padding: 15px; 
      background: linear-gradient(135deg, #0d1117, #e9ecef); 
      border-radius: 8px;
      border-left: 4px solid #58a6ff;
      transition: all 0.2s;
    }

    .spec-item:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.4);
    }

    .spec-label { 
      font-size: 0.85em; 
      color: #666; 
      margin-bottom: 8px;
      text-transform: uppercase;
      font-weight: 600;
      letter-spacing: 0.5px;
    }

    .spec-value { 
      font-weight: bold; 
      color: #e6edf3;
      font-size: 1.05em;
    }

    .robot-performance {
      background: #21262d;
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
    }

    .performance-metrics {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
    }

    .metric-item {
      text-align: center;
      padding: 20px;
      background: linear-gradient(135deg, #e3f2fd, #bbdefb);
      border-radius: 10px;
    }

    .metric-value {
      font-size: 2em;
      font-weight: bold;
      color: #1976d2;
      display: block;
    }

    .metric-label {
      font-size: 0.9em;
      color: #555;
      margin-top: 5px;
    }

    .back-btn {
      background: #6c757d;
      color: #21262d;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 20px;
      transition: all 0.2s;
    }

    .back-btn:hover {
      background: #545b62;
      transform: translateY(-1px);
    }

    .btn-connect {
      background: linear-gradient(135deg, #17a2b8, #138496);
      color: #21262d;
      border: none;
      padding: 10px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.9em;
      font-weight: 600;
      transition: all 0.2s;
      box-shadow: 0 2px 4px rgba(23, 162, 184, 0.3);
    }

    .btn-connect:hover { 
      background: linear-gradient(135deg, #138496, #117a8b);
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(23, 162, 184, 0.4);
    }

    .btn-connect:disabled { 
      background: #30363d; 
      cursor: not-allowed; 
      transform: none;
      box-shadow: none;
    }

    .btn-multi-sync {
      background: linear-gradient(135deg, #17a2b8, #138496);
      color: #21262d;
      border: none;
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.85em;
      font-weight: 600;
      transition: all 0.2s;
      box-shadow: 0 2px 4px rgba(23, 162, 184, 0.3);
    }

    .btn-multi-sync:hover {
      background: linear-gradient(135deg, #138496, #117a8b);
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(23, 162, 184, 0.4);
    }

    .btn-multi-sync.sync-ready {
      background: linear-gradient(135deg, #28a745, #20c997);
      box-shadow: 0 2px 4px rgba(40, 167, 69, 0.3);
    }

    .btn-multi-sync.sync-ready:hover {
      background: linear-gradient(135deg, #218838, #1ea087);
      box-shadow: 0 4px 8px rgba(40, 167, 69, 0.4);
    }

    /* App Detail Page Styles */
    .app-detail-container {
      max-width: 1000px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: 1fr 300px;
      gap: 30px;
    }

    .app-main-content {
      background: #21262d;
      border-radius: 10px;
      padding: 30px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
    }

    .app-header {
      display: flex;
      gap: 20px;
      margin-bottom: 30px;
      align-items: flex-start;
    }

    .app-icon {
      width: 80px;
      height: 80px;
      border-radius: 12px;
      flex-shrink: 0;
    }

    .app-title-section h1 {
      margin: 0 0 10px 0;
      font-size: 2em;
      font-weight: bold;
      color: #e6edf3;
    }

    .app-subtitle {
      color: #666;
      font-size: 1.1em;
      margin-bottom: 15px;
    }

    .app-rating {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
    }

    .stars {
      color: #ffc107;
      font-size: 1.2em;
    }

    .rating-text {
      color: #666;
      font-size: 0.9em;
    }

    .app-developer {
      color: #58a6ff;
      text-decoration: none;
      font-weight: 500;
    }

    .app-developer:hover {
      text-decoration: underline;
    }

    .app-description {
      line-height: 1.6;
      color: #555;
      margin-bottom: 30px;
    }

    .app-features {
      margin-bottom: 30px;
    }

    .app-features h3 {
      margin-bottom: 15px;
      color: #e6edf3;
      font-size: 1.3em;
    }

    .features-list {
      list-style: none;
      padding: 0;
    }

    .features-list li {
      padding: 8px 0;
      border-bottom: 1px solid #eee;
      color: #555;
    }

    .features-list li:before {
      content: "‚úì";
      color: #28a745;
      font-weight: bold;
      margin-right: 10px;
    }

    .screenshots {
      margin-bottom: 30px;
    }

    .screenshots h3 {
      margin-bottom: 15px;
      color: #e6edf3;
      font-size: 1.3em;
    }

    .screenshot-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
    }

    .screenshot {
      width: 100%;
      height: 150px;
      object-fit: cover;
      border-radius: 8px;
      border: 1px solid #30363d;
      cursor: pointer;
      transition: transform 0.2s;
    }

    .screenshot:hover {
      transform: scale(1.05);
    }

    /* Sidebar Styles */
    .app-sidebar {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .sidebar-card {
      background: #21262d;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
    }

    .install-section {
      text-align: center;
    }

    .install-btn {
      background: #58a6ff;
      color: #21262d;
      border: none;
      padding: 15px 30px;
      border-radius: 8px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      width: 100%;
      margin-bottom: 15px;
      transition: background-color 0.2s;
    }

    .install-btn:hover {
      background: #1f6feb;
    }

    .install-btn.uninstall {
      background: #dc3545;
    }

    .install-btn.uninstall:hover {
      background: #c82333;
    }

    .app-info h3 {
      margin-top: 0;
      margin-bottom: 15px;
      color: #e6edf3;
      font-size: 1.2em;
    }

    .info-item {
      display: flex;
      justify-content: space-between;
      padding: 8px 0;
      border-bottom: 1px solid #eee;
    }

    .info-label {
      font-weight: 500;
      color: #666;
    }

    .info-value {
      color: #e6edf3;
      text-align: right;
    }

    /* Modal Styles */
    .modal-overlay { 
      position:fixed; 
      inset:0; 
      background:rgba(0,0,0,0.6); 
      display:none; 
      align-items:center; 
      justify-content:center; 
      z-index:1000; 
    }
    
    .modal { 
      position: relative; 
      background:#21262d; 
      border-radius:10px; 
      width:400px; 
      max-width:90vw;
      box-shadow: 0 10px 25px rgba(0,0,0,0.2);
      border: 3px solid #30363d;
    }
    
    /* Close button */
    .modal-close {
      position: absolute;
      top: 10px;
      right: 10px;
      cursor: pointer;
      font-size: 0.8em;
      color: #999;
      background: none;
      border: none;
      padding: 2px;
      width: 18px;
      height: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      transition: background-color 0.2s;
      line-height: 1;
      flex-shrink: 0;
      z-index: 10;
    }
    
    .modal-close:hover {
      background-color:#f0f0f0;
      color:#e6edf3;
    }
    
    /* Avatar container */
    .imgcontainer {
      text-align: center;
      margin: 24px 0 12px 0;
      position: relative;
    }
    
    /* Avatar image */
    .avatar {
      width: 80px;
      height: 80px;
      border-radius: 50%;
    }
    
    /* Container for form inputs */
    .container {
      padding: 16px;
    }
    
    /* Labels styling */
    .container label {
      font-weight: bold;
      display: block;
      margin-bottom: 5px;
      color: #e6edf3;
    }
    
    /* Full-width inputs */
    .container input[type=text], 
    .container input[type=password],
    .container input[type=email] {
      width: 100%;
      padding: 12px 20px;
      margin: 8px 0;
      display: inline-block;
      border: 1px solid #30363d;
      box-sizing: border-box;
      border-radius: 4px;
      font-size: 14px;
    }
    
    .container input[type=text]:focus,
    .container input[type=password]:focus,
    .container input[type=email]:focus {
      outline: none;
      border-color: #58a6ff;
    }
    
    /* Login button styling */
    .container button[type=submit] {
      background-color: #58a6ff;
      color: #21262d;
      padding: 14px 20px;
      margin: 8px 0;
      border: none;
      cursor: pointer;
      width: 100%;
      border-radius: 4px;
      font-size: 16px;
      font-weight: bold;
      transition: background-color 0.2s;
    }
    
    .container button[type=submit]:hover {
      background-color: #1f6feb;
    }
    
    /* Remember me checkbox styling */
    .remember-me {
      margin: 10px 0;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .remember-me input[type=checkbox] {
      width: 16px;
      height: 16px;
      margin: 0;
    }
    
    .remember-me label {
      margin: 0;
      font-weight: normal;
      cursor: pointer;
    }
    
    /* Bottom container with gray background */
    .bottom-container {
      background-color: #30363d;
      padding: 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-radius: 0 0 10px 10px;
    }
    
    /* Cancel button */
    .cancelbtn {
      width: auto;
      padding: 10px 18px;
      background-color: #f44336;
      color: #21262d;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
    }
    
    .cancelbtn:hover {
      background-color: #da190b;
    }
    
    /* Forgot password link */
    .psw {
      font-size: 14px;
    }
    
    .psw a {
      color: #58a6ff;
      text-decoration: none;
    }
    
    .psw a:hover {
      text-decoration: underline;
    }

    .signin-btn {
      background:#58a6ff;
      color:#21262d;
      border:none;
      padding:8px 16px;
      border-radius:6px;
      cursor:pointer;
      font-weight:bold;
    }
    .signin-btn:hover { background:#1f6feb; }
  

    /* Make ALL text white for visibility */
    * {
        color: #ffffff !important;
    }

    h1, h2, h3, h4, h5, h6 {
        color: #ffffff !important;
    }

    /* All card backgrounds */
    .app-card, .robot-card, .installed-app-card, .robot-type-card, .installed-header, .add-robot-header, .container {
        background: #21262d !important;
        color: #ffffff !important;
        border: 1px solid #30363d !important;
        border-radius: 16px !important;
        position: relative;
        overflow: hidden;
        transition: all 0.3s ease;
    }

    /* Text styling */
    .app-card h3, .robot-title, .installed-app-name, .robot-type-name, .add-robot-title {
        color: #ffffff !important;
        font-weight: 600 !important;
    }

    .app-card p, .robot-type-description, .installed-app-description {
        color: #cccccc !important;
    }

    /* TurtleBot3-style hover effects for all cards */
    .app-card:hover, .robot-card:hover, .installed-app-card:hover, .robot-type-card:hover {
        border: 2px solid #00ffff !important;
        box-shadow: 0 0 25px rgba(0, 255, 255, 0.8), 
                    0 0 50px rgba(0, 255, 255, 0.4),
                    inset 0 0 25px rgba(0, 255, 255, 0.1) !important;
        transform: translateY(-8px) scale(1.03) !important;
        transition: all 0.3s ease;
    }

    .app-card:hover h3, 
    .robot-card:hover .robot-title, 
    .installed-app-card:hover .installed-app-name, 
    .robot-type-card:hover .robot-type-name {
        color: #00ffff !important;
        text-shadow: 0 0 15px #00ffff, 0 0 30px #00ffff !important;
        transition: all 0.3s ease;
    }

    .app-card:hover p,
    .robot-card:hover .robot-type-description,
    .installed-app-card:hover .installed-app-description,
    .robot-type-card:hover .robot-type-description {
        color: #ffffff !important;
        text-shadow: 0 0 8px rgba(255, 255, 255, 0.6) !important;
        transition: all 0.3s ease;
    }

    .app-card:hover img,
    .robot-type-card:hover img {
        filter: drop-shadow(0 0 15px #00ffff) brightness(1.2);
        transform: scale(1.1);
        transition: all 0.3s ease;
    }

    /* ENHANCED BROWSE APPS AREA - Fix the ugly white area */
    .app-main-content {
        background: linear-gradient(135deg, #21262d 0%, #2a2f36 100%) !important;
        border: 2px solid #30363d !important;
        border-radius: 20px !important;
        padding: 40px !important;
        text-align: center;
        position: relative;
        overflow: hidden;
        min-height: 300px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
    }

    /* Add subtle background pattern to Browse Apps area */
    .app-main-content::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: 
            radial-gradient(circle at 25% 25%, rgba(0, 255, 255, 0.03) 0%, transparent 50%),
            radial-gradient(circle at 75% 75%, rgba(138, 43, 226, 0.03) 0%, transparent 50%);
        pointer-events: none;
    }

    /* Style the phone icon in Browse Apps area */
    .app-main-content img {
        width: 80px !important;
        height: 80px !important;
        filter: drop-shadow(0 0 20px rgba(0, 255, 255, 0.4));
        margin-bottom: 30px !important;
        transition: all 0.3s ease;
    }

    /* Enhanced Browse Apps Button */
    .btn-browse {
        background: linear-gradient(45deg, #00ffff, #0080ff) !important;
        color: #ffffff !important;
        border: none !important;
        padding: 15px 35px !important;
        border-radius: 25px !important;
        font-size: 16px !important;
        font-weight: 600 !important;
        text-transform: uppercase !important;
        letter-spacing: 1px !important;
        box-shadow: 0 0 20px rgba(0, 255, 255, 0.4) !important;
        transition: all 0.3s ease !important;
        position: relative !important;
        z-index: 3 !important;
        margin-top: 20px !important;
    }

    .btn-browse:hover {
        background: linear-gradient(45deg, #0080ff, #00ffff) !important;
        box-shadow: 0 0 30px rgba(0, 255, 255, 0.7), 0 0 60px rgba(0, 255, 255, 0.3) !important;
        transform: translateY(-3px) scale(1.05) !important;
        text-shadow: 0 0 10px rgba(255, 255, 255, 0.8) !important;
    }

    /* Add hover effect to the entire Browse Apps area */
    .app-main-content:hover {
        border-color: #00ffff !important;
        box-shadow: 0 0 25px rgba(0, 255, 255, 0.3) !important;
        transition: all 0.3s ease;
    }

    .app-main-content:hover img {
        filter: drop-shadow(0 0 30px rgba(0, 255, 255, 0.6));
        transform: scale(1.1);
    }

    /* Navigation and UI elements */
    .nav-tab {
        color: #ffffff !important;
    }

    .nav-tab:hover {
        color: #00ffff !important;
        text-shadow: 0 0 8px #00ffff, 0 0 16px #00ffff !important;
        transition: all 0.3s ease;
    }

    .dropdown-content div {
        color: #ffffff !important;
    }

    .dropdown-content div:hover {
        background-color: rgba(0, 255, 255, 0.1) !important;
        color: #00ffff !important;
        text-shadow: 0 0 8px #00ffff !important;
        transition: all 0.3s ease;
    }

    /* Input fields */
    input, select, .search-installed, #searchInput {
        color: #ffffff !important;
        background: #21262d !important;
        border: 1px solid #30363d !important;
    }

    input::placeholder {
        color: #888888 !important;
    }

    input:focus, select:focus, .search-installed:focus {
        border-color: #00ffff !important;
        box-shadow: 0 0 10px rgba(0, 255, 255, 0.5) !important;
        outline: none !important;
        transition: all 0.3s ease;
    }

    /* Buttons */
    .button, .btn-primary, .install-btn, .multi-btn, .signin-btn, .bulk-btn, .action-btn {
        background: #21262d !important;
        color: #ffffff !important;
        border: 1px solid #30363d !important;
    }

    .button:hover, .btn-primary:hover, .install-btn:hover, .multi-btn:hover, .signin-btn:hover, .bulk-btn:hover, .action-btn:hover {
        box-shadow: 0 0 15px rgba(0, 255, 255, 0.6) !important;
        border: 1px solid #00ffff !important;
        color: #00ffff !important;
        text-shadow: 0 0 5px #00ffff !important;
        transition: all 0.3s ease;
    }

    .user-label:hover {
        box-shadow: 0 0 15px rgba(0, 255, 255, 0.6) !important;
        border: 1px solid #00ffff !important;
        transition: all 0.3s ease;
    }

    /* Stats styling */
    .stat-number {
        color: #00ffff !important;
        font-weight: 700 !important;
        font-size: 24px !important;
        text-shadow: 0 0 5px rgba(0, 255, 255, 0.5) !important;
    }

    .stat-label, .meta-item {
        color: #cccccc !important;
    }

    /* Form fields */
    .form-field label {
        color: #ffffff !important;
        font-weight: 500 !important;
    }

    .form-field input, .form-field select {
        background: #21262d !important;
        color: #ffffff !important;
        border: 1px solid #30363d !important;
    }
    </style>
</head>
<body>
  <!-- Navbar -->
  <div class="navbar">
    <div class="nav-tabs">
      <div class="nav-tab active" onclick="showView('explore')">Explore</div>
      <div class="nav-tab" onclick="showView('installed')">Installed</div>
      <div class="nav-tab" onclick="showView('robot')">Robot</div>
    </div>
    <div id="authArea">
      <button class="signin-btn" onclick="showLogin()">Sign In</button>
    </div>
  </div>

  <!-- Views -->
  <div id="explore" class="view">
    <input id="searchInput" placeholder="Search apps..." oninput="renderExplore()" style="width:100%;padding:10px;border:1px solid #ccc;border-radius:8px;margin-bottom:20px;">
    <div class="card-grid" id="exploreGrid"></div>
  </div>

  <!-- Enhanced Installed Apps View -->
  <div id="installed" class="view">
    <div class="installed-header">
      <h2 class="installed-title">Installed Applications</h2>
      <div class="installed-stats">
        <div class="stat-item">
          <span class="stat-number" id="installedCount">0</span>
          <span class="stat-label">Apps</span>
        </div>
        <div class="stat-item">
          <span class="stat-number" id="totalSize">0 MB</span>
          <span class="stat-label">Total Size</span>
        </div>
      </div>
    </div>

    <div class="installed-controls">
      <input type="text" class="search-installed" id="searchInstalled" placeholder="Search installed apps..." oninput="filterInstalledApps()">
      <select class="filter-dropdown" id="categoryFilter" onchange="filterInstalledApps()">
        <option value="">All Categories</option>
        <option value="Creative Tools">Creative Tools</option>
        <option value="Navigation">Navigation</option>
        <option value="Entertainment">Entertainment</option>
        <option value="AI & Vision">AI & Vision</option>
        <option value="Interface">Interface</option>
        <option value="Social Interaction">Social Interaction</option>
        <option value="Logistics">Logistics</option>
        <option value="Monitoring">Monitoring</option>
      </select>
      <div class="bulk-actions">
        <button class="bulk-btn" onclick="selectAllApps()">Select All</button>
        <button class="bulk-btn danger" onclick="uninstallSelected()">Uninstall Selected</button>
      </div>
    </div>

    <div class="installed-apps-grid" id="installedAppsList">
      <!-- Apps will be populated here -->
    </div>

    <div class="no-apps-message" id="noAppsMessage" style="display: none;">
      <div class="no-apps-icon">üì±</div>
      <div class="no-apps-text">No apps installed yet</div>
      <div class="no-apps-subtext">Browse the store to find and install robotics applications</div>
      <button class="browse-apps-btn" onclick="showView('explore')">Browse Apps</button>
    </div>
  </div>

  <!-- Enhanced Robot Management View -->
  <div id="robot" class="view">
    <h2>Your Robots</h2>
    <div id="robotList"></div>
    
    <!-- Multi-Robot Control Panel -->
    <div id="multiRobotPanel" class="multi-robot-panel" style="display: none;">
      <h3>ü§ñ Multi-Robot Coordination Center</h3>
      <div class="multi-robot-stats">
        <div class="multi-stat-item">
          <span class="multi-stat-number" id="selectedRobotCount">0</span>
          <span class="multi-stat-label">Selected Robots</span>
        </div>
        <div class="multi-stat-item">
          <span class="multi-stat-number" id="syncReadyCount">0</span>
          <span class="multi-stat-label">Sync Ready</span>
        </div>
      </div>
      <div class="multi-robot-controls">
        <button class="multi-btn primary" onclick="launchMultiRobotSimulation()">üöÄ Launch Multi-Robot Sim</button>
        <button class="multi-btn" onclick="showCoordinationTasks()">‚öôÔ∏è Setup Tasks</button>
        <button class="multi-btn" onclick="clearRobotSelection()">üóëÔ∏è Clear Selection</button>
      </div>
    </div>

    <button class="btn-primary" onclick="showAddRobot()" style="margin-top: 20px;">‚ûï Add Robot</button>
  </div>

  <!-- Enhanced Robot Detail View -->
  <div id="robotDetail" class="view">
    <button class="back-btn" onclick="showView('robot')">‚Üê Back to Robots</button>
    
    <div class="robot-detail-container">
      <div class="robot-detail-header">
        <div class="robot-info">
          <div class="robot-name" id="robotDetailName">
            <span class="robot-type-icon" id="robotDetailIcon">ü§ñ</span>
            <span>Robot Name</span>
          </div>
          <div class="robot-details">
            <div class="detail-item">
              <span class="detail-label">Robot Type</span>
              <span class="detail-value" id="robotDetailType"></span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Model</span>
              <span class="detail-value" id="robotDetailModel"></span>
            </div>
            <div class="detail-item">
              <span class="detail-label">IP Address</span>
              <span class="detail-value" id="robotDetailIP"></span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Status</span>
              <span class="detail-value">
                <span id="robotDetailStatus" class="status-badge"></span>
              </span>
            </div>
          </div>
        </div>
        <div class="robot-actions">
          <button class="btn-gazebo" onclick="launchInGazebo()">üöÄ Launch in Gazebo</button>
          <button class="btn-delete" onclick="deleteRobot()">üóëÔ∏è Delete Robot</button>
        </div>
      </div>

      <div class="robot-stats-grid">
        <div class="robot-specs">
          <div class="specs-title">
            <span>üìã</span>
            <span>Robot Specifications</span>
          </div>
          <div class="specs-grid" id="robotSpecs"></div>
        </div>

        <div class="robot-performance">
          <div class="specs-title">
            <span>üìä</span>
            <span>Performance Metrics</span>
          </div>
          <div class="performance-metrics">
            <div class="metric-item">
              <span class="metric-value">98.2%</span>
              <span class="metric-label">Uptime</span>
            </div>
            <div class="metric-item">
              <span class="metric-value">47¬∞C</span>
              <span class="metric-label">CPU Temp</span>
            </div>
            <div class="metric-item">
              <span class="metric-value">2.1GB</span>
              <span class="metric-label">Memory Used</span>
            </div>
            <div class="metric-item">
              <span class="metric-value">156h</span>
              <span class="metric-label">Runtime</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Enhanced App Detail View -->
  <div id="appDetail" class="view">
    <button class="back-btn" onclick="showView('explore')">‚Üê Back to Store</button>
    
    <div class="app-detail-container">
      <div class="app-main-content">
        <div class="app-header">
          <img id="detailImage" class="app-icon" src="" alt="App Icon">
          <div class="app-title-section">
            <h1 id="detailTitle"></h1>
            <p class="app-subtitle" id="detailSubtitle"></p>
            <div class="app-rating">
              <div class="stars" id="detailStars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ</div>
              <span class="rating-text" id="detailRating">(4.2/5 - 128 reviews)</span>
            </div>
            <a href="#" class="app-developer" id="detailDeveloper">TurtleBot Robotics Team</a>
          </div>
        </div>

        <div class="app-description" id="detailDescription"></div>

        <div class="app-features">
          <h3>Key Features</h3>
          <ul class="features-list" id="detailFeatures"></ul>
        </div>

        <div class="screenshots">
          <h3>Screenshots</h3>
          <div class="screenshot-grid" id="detailScreenshots"></div>
        </div>
      </div>

      <div class="app-sidebar">
        <div class="sidebar-card install-section">
          <button class="install-btn" id="installBtn"></button>
          <div style="color: #666; font-size: 0.9em; margin-top: 10px;" id="installNote">
            Compatible with TurtleBot 3
          </div>
        </div>

        <div class="sidebar-card app-info">
          <h3>App Information</h3>
          <div class="info-item">
            <span class="info-label">Version</span>
            <span class="info-value" id="detailVersion">1.2.3</span>
          </div>
          <div class="info-item">
            <span class="info-label">Size</span>
            <span class="info-value" id="detailSize">15.6 MB</span>
          </div>
          <div class="info-item">
            <span class="info-label">Category</span>
            <span class="info-value" id="detailCategory">Robotics</span>
          </div>
          <div class="info-item">
            <span class="info-label">License</span>
            <span class="info-value" id="detailLicense">MIT</span>
          </div>
          <div class="info-item">
            <span class="info-label">Last Updated</span>
            <span class="info-value" id="detailUpdated">Nov 15, 2024</span>
          </div>
          <div class="info-item">
            <span class="info-label">Downloads</span>
            <span class="info-value" id="detailDownloads">2.1K</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Enhanced Add Robot View -->
  <div id="addRobot" class="view">
    <div class="add-robot-container">
      <div class="add-robot-header">
        <h1 class="add-robot-title">Add New Robot</h1>
        <p class="add-robot-subtitle">Choose your robot type and configure it for your robotics projects</p>
      </div>

      <div class="robot-type-grid">
        <div class="robot-type-card" onclick="selectBotType('TurtleBot3')">
          <span class="robot-type-icon">üê¢</span>
          <div class="robot-type-name">TurtleBot3</div>
          <div class="robot-type-description">Mobile research platform for education, research and product prototyping</div>
          <ul class="robot-type-features">
            <li>360¬∞ LiDAR sensor</li>
            <li>Onboard computer</li>
            <li>Differential drive</li>
            <li>ROS compatible</li>
          </ul>
        </div>

        <div class="robot-type-card" onclick="selectBotType('Manipulator')">
          <span class="robot-type-icon">ü¶æ</span>
          <div class="robot-type-name">Manipulator</div>
          <div class="robot-type-description">Robotic arm for precision manipulation and industrial automation</div>
          <ul class="robot-type-features">
            <li>6-DOF articulation</li>
            <li>Force/torque sensing</li>
            <li>High precision control</li>
            <li>Industrial grade</li>
          </ul>
        </div>

        <div class="robot-type-card" onclick="selectBotType('Drone')">
          <span class="robot-type-icon">üöÅ</span>
          <div class="robot-type-name">Drone</div>
          <div class="robot-type-description">Unmanned aerial vehicle for surveillance, mapping, and delivery</div>
          <ul class="robot-type-features">
            <li>GPS navigation</li>
            <li>Camera gimbal</li>
            <li>Autonomous flight</li>
            <li>Long battery life</li>
          </ul>
        </div>


        <div class="robot-type-card" onclick="selectBotType('Cobot')">
  <span class="robot-type-icon">ü§ù</span>
  <div class="robot-type-name">Cobots</div>
  <div class="robot-type-description">
    Collaborative robots designed to safely work alongside humans
  </div>
  <ul class="robot-type-features">
    <li>Human-safe design</li>
    <li>Force/torque sensing</li>
    <li>Easy programming</li>
    <li>Industrial & service use</li>
  </ul>
</div>
        

        <div class="robot-type-card" onclick="selectBotType('Humanoid')">
          <span class="robot-type-icon">üßç</span>
          <div class="robot-type-name">Humanoid</div>
          <div class="robot-type-description">Human-like robot for social interaction and service applications</div>
          <ul class="robot-type-features">
            <li>Bipedal locomotion</li>
            <li>Speech recognition</li>
            <li>Facial expressions</li>
            <li>Social interaction</li>
          </ul>
        </div>
      </div>

      <div class="robot-form-container" id="robotFormContainer">
        <div class="robot-form-header">
          <h2 class="robot-form-title" id="robotFormTitle">
            <span id="robotFormIcon">ü§ñ</span>
            <span id="robotFormTitleText">Configure Robot</span>
          </h2>
          <p class="robot-form-subtitle">Enter the details for your new robot</p>
        </div>

        <div class="form-grid">
          <div class="form-field">
            <label for="botName">Robot Name</label>
            <input type="text" id="botName" placeholder="Enter a unique name for your robot" required>
          </div>

          <div class="form-field">
            <label for="botModel">Robot Model</label>
            <select id="botModel" required>
              <option value="">-- Select Model --</option>
            </select>
          </div>

          <div class="form-field">
            <label for="botIP">IP Address</label>
            <input type="text" id="botIP" placeholder="192.168.1.100" pattern="^(?:[0-9]{1,3}\.){3}[0-9]{1,3}$" required>
          </div>

          <div class="form-field">
            <label for="botLocation">Location</label>
            <input type="text" id="botLocation" placeholder="Lab, Office, Home, etc.">
          </div>

          <div class="form-field full-width">
            <label for="botDescription">Description (Optional)</label>
            <input type="text" id="botDescription" placeholder="Brief description of robot purpose or configuration">
          </div>
        </div>

        <div class="form-actions">
          <button type="button" class="btn-secondary" onclick="showView('robot')">Cancel</button>
          <button type="button" class="btn-primary" onclick="saveRobot()">Add Robot</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Multi-Robot Task Modal -->
<div id="multiRobotTaskModal" class="modal-overlay" style="display: none;">
  <div class="modal" style="width: 500px;">
    <button class="modal-close" onclick="document.getElementById('multiRobotTaskModal').style.display='none'">√ó</button>
    
    <div style="padding: 30px;">
      <h2>ü§ñ Multi-Robot Coordination</h2>
      <p>Assign specific tasks to each robot based on its capabilities:</p>
      
      <div id="robotTaskAssignments" style="margin: 20px 0;">
        <!-- Robot task dropdowns will be inserted here dynamically -->
      </div>

      <div style="display: flex; gap: 15px; justify-content: center; margin-top: 30px;">
        <button class="btn-primary" onclick="startCoordinatedTask()">Start Collaborative Tasks</button>
        <button class="btn-secondary" onclick="document.getElementById('multiRobotTaskModal').style.display='none'">Cancel</button>
      </div>
    </div>
  </div>
</div>

<script>
  // Example capabilities based on robot type
  const robotCapabilities = {
    "TurtleBot3": [
      "Navigate to location",
      "Map environment",
      "Follow path",
      "Follow object",
      "Collaborative mapping"
    ],
    "Manipulator": [
      "Pick and place",
      "Assemble part",
      "Press button",
      "Collaborative assembly"
    ]
  };

  // Show the coordination modal and build robot-specific task dropdowns
  function showCoordinationTasks() {
    const modal = document.getElementById('multiRobotTaskModal');
    const container = document.getElementById('robotTaskAssignments');
    container.innerHTML = "";

    if (!window.selectedRobots || window.selectedRobots.length === 0) {
      alert("No robots selected for coordination.");
      return;
    }

    window.selectedRobots.forEach(robot => {
      const taskOptions = robotCapabilities[robot.type] || ["No capabilities available"];

      const wrapper = document.createElement("div");
      wrapper.style.marginBottom = "15px";

      wrapper.innerHTML = `
        <label><strong>${robot.name} (${robot.type})</strong></label>
        <select id="taskSelect_${robot.name}" style="width: 100%; padding: 10px; margin-top: 5px;">
          ${taskOptions.map(task => `<option value="${task}">${task}</option>`).join('')}
        </select>
      `;

      container.appendChild(wrapper);
    });

    modal.style.display = 'block';
  }

  // Collect and send assigned tasks to backend
  function startCoordinatedTask() {
    const assignments = {};

    window.selectedRobots.forEach(robot => {
      const dropdown = document.getElementById(`taskSelect_${robot.name}`);
      if (dropdown) {
        assignments[robot.name] = dropdown.value;
      }
    });

    console.log("Assigned tasks:", assignments);

    fetch("/api/assign_tasks", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ tasks: assignments })
    })
    .then(res => res.json())
    .then(data => {
      alert("Tasks assigned successfully!");
      console.log(data);
      document.getElementById('multiRobotTaskModal').style.display='none';
    })
    .catch(err => {
      console.error(err);
      alert("Failed to assign tasks.");
    });
  }
</script>


  <!-- Login Modal -->
  <div id="loginModal" class="modal-overlay">
    <div class="modal">
      <button class="modal-close" onclick="closeLogin()">√ó</button>
      
      <form onsubmit="event.preventDefault(); login();">
        <div class="imgcontainer">
          <img src="https://www.w3schools.com/howto/img_avatar2.png" alt="Avatar" class="avatar">
        </div>

        <div class="container">
          <label for="email"><b>Username</b></label>
          <input id="email" type="email" placeholder="Enter Email" name="email" required>

          <label for="password"><b>Password</b></label>
          <input id="password" type="password" placeholder="Enter Password" name="password" required>
            
          <button type="submit">Login</button>
          
          <div class="remember-me">
            <input type="checkbox" id="remember" name="remember" value="remember">
            <label for="remember">Remember me</label>
          </div>
        </div>

        <div class="bottom-container">
          <button type="button" class="cancelbtn" onclick="closeLogin()">Cancel</button>
          <span class="psw">Forgot <a href="#">password?</a></span>
        </div>
      </form>
    </div>
  </div>

  <script>
    let userEmail = null;
    let userData = { apps: [], robots: [] };
    let currentRobotIndex = -1;
    let selectedApps = new Set();
    let selectedRobots = new Set();
    let selectedRobotType = '';
    let syncReadyRobots = new Set();
    const LOCAL_INSTALLER_URL = "http://localhost:8080";

    const robotTypeIcons = {
  'TurtleBot3': 'üê¢',
  'Manipulator': 'ü¶æ',
  'Drone': 'üöÅ',
  'Cobot': 'ü§ù',
  'Humanoid': 'üßç'
};

    const tools = [
      { 
        name: "Shape Drawer", 
        description: "Create beautiful geometric shapes and patterns with your robot", 
        image: "https://cdn-icons-png.flaticon.com/512/4821/4821461.png",
        detailedDescription: "Shape Drawer is a comprehensive drawing application that allows your TurtleBot to create intricate geometric patterns, shapes, and artistic designs. Perfect for educational demonstrations, art projects, and showcasing robot precision control.",
        features: [
          "Draw circles, squares, triangles, and custom polygons",
          "Adjustable pen color and thickness settings",
          "Pre-programmed pattern library with 50+ designs",
          "Real-time path visualization and preview",
          "Save and export drawings as SVG files",
          "Educational mode with step-by-step tutorials"
        ],
        screenshots: [
          "https://via.placeholder.com/200x150/4CAF50/white?text=Circle+Demo",
          "https://via.placeholder.com/200x150/2196F3/white?text=Pattern+View",
          "https://via.placeholder.com/200x150/FF9800/white?text=Settings"
        ],
        version: "2.1.4",
        size: "8.2 MB",
        category: "Creative Tools",
        developer: "RoboArt Studios",
        rating: "‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ",
        ratingText: "(4.3/5 - 89 reviews)",
        downloads: "1.2K",
        updated: "Dec 3, 2024",
        installedDate: "Nov 15, 2024"
      },

      { 
        name: "SLAM Mapper", 
        description: "Advanced simultaneous localization and mapping for autonomous navigation", 
        image: "https://cdn-icons-png.flaticon.com/512/3144/3144456.png",
        detailedDescription: "SLAM Mapper provides state-of-the-art simultaneous localization and mapping capabilities for your robot. Build detailed environmental maps while tracking your robot's position in real-time with industry-leading accuracy.",
        features: [
          "Real-time 2D and 3D mapping using LiDAR sensors",
          "Loop closure detection and correction",
          "Multi-floor mapping support",
          "Export maps in various formats (ROS, PNG, PGM)",
          "Live visualization with web interface",
          "Integration with path planning algorithms"
        ],
        screenshots: [
          "https://via.placeholder.com/200x150/9C27B0/white?text=Live+Map",
          "https://via.placeholder.com/200x150/795548/white?text=3D+View",
          "https://via.placeholder.com/200x150/607D8B/white?text=Settings"
        ],
        version: "3.0.1",
        size: "45.3 MB",
        category: "Navigation",
        developer: "AutonomousNav Inc.",
        rating: "‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ",
        ratingText: "(4.8/5 - 234 reviews)",
        downloads: "3.4K",
        updated: "Nov 28, 2024",
        installedDate: "Oct 22, 2024"
      },

      {
  "name": "Patrolling",
  "description": "Autonomous patrol routine across multiple waypoints, with area announcements and logging.",
  "image": "https://cdn-icons-png.flaticon.com/512/711/711245.png",
  "detailedDescription": "Let your TurtleBot3 patrol a set of custom or pre-configured waypoints in your lab, home, or office. The robot announces each location as it arrives and logs the patrol for activity review‚Äîideal for demonstrations, security checks, or playful monitoring.",
  "features": [
    "Configurable patrol routes",
    "Waypoint arrival announcements",
    "Persistent patrol logging",
    "Obstacle avoidance included",
    "Compatible with Nav2/MoveBase stacks"
  ],
  "screenshots": [
    "https://via.placeholder.com/200x150/4CAF50/white?text=PatrolRoute",
    "https://via.placeholder.com/200x150/2196F3/white?text=WaypointLog",
    "https://via.placeholder.com/200x150/FF9800/white?text=VoiceAnnouncement"
  ],
  "version": "1.0.0",
  "size": "20.5 MB",
  "category": "Navigation",
  "developer": "Axiom Robotics",
  "rating": "",
  "ratingText": "New app ‚Äî reviews coming soon.",
  "downloads": 0,
  "updated": "Nov 26, 2025",
  "installedDate": "",
  "scripturl": "https://raw.githubusercontent.com/Axiom-Robotics/robot-apps/main/apps/turtlebot3/patrol/patrol_announce.py",
  "scriptfilename": "patrol_announce.py",
  "commands": ["patrol", "start patrol", "security patrol", "waypoint patrol"],
  "robottype": "turtlebot3"
},
      { 
        name: "Dance Bot", 
        description: "Choreographed dance routines and entertainment programming", 
        image: "https://cdn-icons-png.flaticon.com/512/3709/3709072.png",
        detailedDescription: "Transform your robot into an entertaining dance partner! Dance Bot includes dozens of pre-programmed choreographies and allows you to create custom dance sequences synchronized to music.",
        features: [
          "20+ pre-programmed dance routines",
          "Music synchronization and beat detection",
          "Custom choreography editor with timeline",
          "Group dance coordination for multiple robots",
          "LED light show integration",
          "Performance recording and sharing"
        ],
        screenshots: [
          "https://via.placeholder.com/200x150/E91E63/white?text=Dance+Move",
          "https://via.placeholder.com/200x150/3F51B5/white?text=Choreography",
          "https://via.placeholder.com/200x150/FF5722/white?text=LED+Show"
        ],
        version: "1.8.2",
        size: "32.1 MB",
        category: "Entertainment",
        developer: "RoboDance Productions",
        rating: "‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ",
        ratingText: "(4.1/5 - 156 reviews)",
        downloads: "2.8K",
        updated: "Dec 1, 2024",
        installedDate: "Nov 8, 2024"
      },
      { 
        name: "Object Tracker", 
        description: "AI-powered object detection and tracking system", 
        image: "https://cdn-icons-png.flaticon.com/512/3081/3081584.png",
        detailedDescription: "Advanced computer vision application that enables your robot to detect, identify, and track objects in real-time. Uses cutting-edge AI models for accurate recognition of people, pets, and everyday items.",
        features: [
          "Real-time object detection using YOLO v5",
          "Track multiple objects simultaneously",
          "Person and face recognition capabilities",
          "Custom object training interface",
          "Behavior logging and analytics",
          "Integration with security systems"
        ],
        screenshots: [
          "https://via.placeholder.com/200x150/4CAF50/white?text=Detection",
          "https://via.placeholder.com/200x150/FF9800/white?text=Tracking",
          "https://via.placeholder.com/200x150/2196F3/white?text=Analytics"
        ],
        version: "4.2.0",
        size: "128.7 MB",
        category: "AI & Vision",
        developer: "VisionTech Solutions",
        rating: "‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ",
        ratingText: "(4.7/5 - 312 reviews)",
        downloads: "5.6K",
        updated: "Dec 5, 2024",
        installedDate: "Sep 30, 2024"
      },
      { 
        name: "Obstacle Avoider", 
        description: "Intelligent navigation with dynamic obstacle avoidance", 
        image: "https://cdn-icons-png.flaticon.com/512/3064/3064197.png",
        detailedDescription: "Smart navigation system that enables your robot to move through complex environments while avoiding obstacles. Features adaptive pathfinding and learning algorithms for improved performance over time.",
        features: [
          "Dynamic obstacle detection and avoidance",
          "Adaptive pathfinding algorithms",
          "Learning-based behavior improvement",
          "Multi-sensor fusion (LiDAR, camera, ultrasonic)",
          "Emergency stop and recovery modes",
          "Customizable safety parameters"
        ],
        screenshots: [
          "https://via.placeholder.com/200x150/795548/white?text=Navigation",
          "https://via.placeholder.com/200x150/607D8B/white?text=Sensors",
          "https://via.placeholder.com/200x150/9E9E9E/white?text=Path+Plan"
        ],
        version: "2.5.3",
        size: "67.4 MB",
        category: "Navigation",
        developer: "SmartNav Robotics",
        rating: "‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ",
        ratingText: "(4.4/5 - 198 reviews)",
        downloads: "4.2K",
        updated: "Nov 22, 2024",
        installedDate: "Nov 1, 2024"
      },
      { 
        name: "Voice Commander", 
        description: "Voice-controlled robot operation and command interface", 
        image: "https://cdn-icons-png.flaticon.com/512/727/727399.png",
        detailedDescription: "Control your robot using natural voice commands! Voice Commander features advanced speech recognition, custom command creation, and multi-language support for intuitive robot interaction.",
        features: [
          "Natural language processing and understanding",
          "Custom voice command creation",
          "Multi-language support (10+ languages)",
          "Voice authentication and user profiles",
          "Offline speech recognition capability",
          "Integration with smart home systems"
        ],
        screenshots: [
          "https://via.placeholder.com/200x150/9C27B0/white?text=Voice+UI",
          "https://via.placeholder.com/200x150/673AB7/white?text=Commands",
          "https://via.placeholder.com/200x150/3F51B5/white?text=Settings"
        ],
        version: "3.1.8",
        size: "89.2 MB",
        category: "Interface",
        developer: "VocalBot Technologies",
        rating: "‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ",
        ratingText: "(4.2/5 - 267 reviews)",
        downloads: "7.1K",
        updated: "Nov 30, 2024",
        installedDate: "Oct 15, 2024"
      },
      { 
        name: "Face Follower", 
        description: "Human face detection and following behavior system", 
        image: "https://cdn-icons-png.flaticon.com/512/2920/2920265.png",
        detailedDescription: "Engage in natural human-robot interaction with Face Follower. Your robot will detect and follow human faces while maintaining appropriate social distances and avoiding obstacles.",
        features: [
          "Real-time face detection and tracking",
          "Multiple face recognition and switching",
          "Social distance maintenance algorithms",
          "Emotion recognition and response",
          "Safe following with obstacle avoidance",
          "Privacy-focused processing (no face storage)"
        ],
        screenshots: [
          "https://via.placeholder.com/200x150/E91E63/white?text=Face+Track",
          "https://via.placeholder.com/200x150/F44336/white?text=Follow+Mode",
          "https://via.placeholder.com/200x150/FF5722/white?text=Social+Dist"
        ],
        version: "1.9.4",
        size: "54.8 MB",
        category: "Social Interaction",
        developer: "Social Robotics Lab",
        rating: "‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ",
        ratingText: "(4.0/5 - 143 reviews)",
        downloads: "2.3K",
        updated: "Dec 2, 2024",
        installedDate: "Nov 12, 2024"
      },
      { 
        name: "Path Planner", 
        description: "Advanced route planning and execution system", 
        image: "https://cdn-icons-png.flaticon.com/512/1055/1055646.png",
        detailedDescription: "Professional-grade path planning application for complex navigation tasks. Create optimal routes, waypoint missions, and automated patrol patterns with precision timing control.",
        features: [
          "A* and RRT path planning algorithms",
          "Waypoint mission editor with timing",
          "Optimal route calculation with constraints",
          "Multi-goal planning and scheduling",
          "Real-time path re-planning capabilities",
          "Integration with mapping systems"
        ],
        screenshots: [
          "https://via.placeholder.com/200x150/4CAF50/white?text=Route+Plan",
          "https://via.placeholder.com/200x150/8BC34A/white?text=Waypoints",
          "https://via.placeholder.com/200x150/CDDC39/white?text=Execution"
        ],
        version: "2.7.1",
        size: "41.3 MB",
        category: "Navigation",
        developer: "PathTech Solutions",
        rating: "‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ",
        ratingText: "(4.6/5 - 189 reviews)",
        downloads: "3.7K",
        updated: "Nov 25, 2024",
        installedDate: "Oct 5, 2024"
      },
      { 
        name: "Delivery Bot", 
        description: "Autonomous package delivery and logistics system", 
        image: "https://cdn-icons-png.flaticon.com/512/753/753318.png",
        scripturl: "https://raw.githubusercontent.com/Axiom-Robotics/robot-apps/main/apps/turtlebot3/logistics/delivery_route.py",
    scriptfilename: "delivery_route.py",
    commands: ["delivery run", "start delivery", "courier mode"],
    category: "logistics",
    robottype: "turtlebot3",
        detailedDescription: "Transform your robot into an autonomous delivery system! Features package tracking, secure delivery protocols, and integration with logistics platforms for efficient last-mile delivery solutions.",
        features: [
          "Package tracking and inventory management",
          "Secure delivery with PIN/QR code verification",
          "Route optimization for multiple deliveries",
          "Integration with delivery platforms",
          "Load capacity monitoring and alerts",
          "Delivery confirmation and notifications"
        ],
        screenshots: [
          "https://via.placeholder.com/200x150/FF9800/white?text=Package+Track",
          "https://via.placeholder.com/200x150/FF5722/white?text=Delivery+Map",
          "https://via.placeholder.com/200x150/795548/white?text=Confirmation"
        ],
        version: "1.4.6",
        size: "73.9 MB",
        category: "Logistics",
        developer: "RoboLogistics Corp",
        rating: "‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ",
        ratingText: "(4.3/5 - 167 reviews)",
        downloads: "2.9K",
        updated: "Dec 4, 2024",
        installedDate: "Nov 20, 2024"
      },
      { 
        name: "Sensor Dashboard", 
        description: "Real-time sensor monitoring and data visualization platform", 
        image: "https://cdn-icons-png.flaticon.com/512/2487/2487635.png",
        detailedDescription: "Comprehensive sensor monitoring solution providing real-time visualization of all robot sensors. Features customizable dashboards, data logging, and alert systems for professional monitoring.",
        features: [
          "Real-time sensor data visualization",
          "Customizable dashboard layouts",
          "Historical data logging and export",
          "Alert system for sensor anomalies",
          "Multi-robot monitoring support",
          "Web-based remote access interface"
        ],
        screenshots: [
          "https://via.placeholder.com/200x150/2196F3/white?text=Dashboard",
          "https://via.placeholder.com/200x150/03A9F4/white?text=Charts",
          "https://via.placeholder.com/200x150/00BCD4/white?text=Alerts"
        ],
        version: "3.3.2",
        size: "25.7 MB",
        category: "Monitoring",
        developer: "SensorTech Industries",
        rating: "‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ",
        ratingText: "(4.5/5 - 201 reviews)",
        downloads: "4.8K",
        updated: "Nov 29, 2024",
        installedDate: "Oct 18, 2024"
      }
    ];

    const modelOptions = {
  TurtleBot3: ["burger", "waffle", "waffle_pi"],
  Drone: ["PX4", "ArduPilot", "Crazyflie"],
  Cobot: ["UR Collaborative", "Franka Emika", "ABB YuMi", "Doosan"],
  Manipulator: ["UR5", "KUKA LBR iiwa", "ABB IRB120", "Franka Panda"],
  Humanoid: ["NAO", "Pepper", "Atlas", "ASIMO"]
};

    const robotSpecs = {
      TurtleBot3: {
        burger: { dimensions: "178√ó138√ó192mm", weight: "1kg", sensors: "360¬∞ LiDAR, IMU, Camera", battery: "1800mAh", connectivity: "WiFi, Bluetooth" },
        waffle: { dimensions: "281√ó306√ó141mm", weight: "1.8kg", sensors: "360¬∞ LiDAR, IMU, Camera", battery: "2800mAh", connectivity: "WiFi, Bluetooth" },
        waffle_pi: { dimensions: "281√ó306√ó141mm", weight: "1.8kg", sensors: "360¬∞ LiDAR, IMU, Camera", battery: "2800mAh", connectivity: "WiFi, Bluetooth" }
      },
      Drone: {
        PX4: { dimensions: "250√ó250√ó100mm", weight: "1.2kg", sensors: "GPS, IMU, Barometer", battery: "4000mAh", connectivity: "WiFi, Radio Control" },
        ArduPilot: { dimensions: "300√ó300√ó120mm", weight: "1.5kg", sensors: "GPS, IMU, Compass", battery: "5000mAh", connectivity: "WiFi, Radio Control" },
        Crazyflie: { dimensions: "92√ó92√ó29mm", weight: "27g", sensors: "IMU, Barometer, Optical Flow", battery: "240mAh", connectivity: "Radio, Bluetooth" }
      },
      Manipulator: {
        UR3: { dimensions: "159√ó159√ó220mm", weight: "11kg", sensors: "Force/Torque, Joint encoders", battery: "N/A (AC powered)", connectivity: "Ethernet, USB" },
        UR5: { dimensions: "149√ó149√ó188mm", weight: "18.4kg", sensors: "Force/Torque, Joint encoders", battery: "N/A (AC powered)", connectivity: "Ethernet, USB" },
        "Kinova Gen3": { dimensions: "√ò105√ó903mm", weight: "7.2kg", sensors: "Vision, Force/Torque", battery: "N/A (AC powered)", connectivity: "Ethernet, USB" }
      },
      Humanoid: {
        NAO: { dimensions: "275√ó181√ó566mm", weight: "5.4kg", sensors: "Cameras, IMU, Microphones", battery: "2150mAh", connectivity: "WiFi, Ethernet" },
        Pepper: { dimensions: "425√ó485√ó1210mm", weight: "28kg", sensors: "Cameras, LiDAR, Touch", battery: "30Ah", connectivity: "WiFi, Ethernet" },
        Atlas: { dimensions: "1500√ó600√ó1900mm", weight: "89kg", sensors: "Cameras, LiDAR, IMU", battery: "N/A (Tethered)", connectivity: "Tethered Connection" }
      }
    };

    function showView(view) {
      document.querySelectorAll('.view').forEach(v => v.style.display = 'none');
      document.getElementById(view).style.display = 'block';
      document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
      const active = document.querySelector(`.nav-tab[onclick*="${view}"]`);
      if (active) active.classList.add('active');
      if (view === 'explore') renderExplore();
      if (view === 'installed') renderInstalled();
      if (view === 'robot') renderRobots();
    }

    function renderExplore() {
      const grid = document.getElementById("exploreGrid");
      const q = document.getElementById("searchInput").value.toLowerCase();
      grid.innerHTML = "";
      tools.filter(t => t.name.toLowerCase().includes(q)).forEach((tool, i) => {
        const d = document.createElement("div");
        d.className = "app-card";
        d.innerHTML = `<img src="${tool.image}"><h3>${tool.name}</h3><p>${tool.description}</p>`;
        d.onclick = () => showDetail(i);
        grid.appendChild(d);
      });
    }

    function renderInstalled() {
      const installedApps = userData.apps.map(appName => 
        tools.find(tool => tool.name === appName)
      ).filter(Boolean);

      const container = document.getElementById("installedAppsList");
      const noAppsMessage = document.getElementById("noAppsMessage");
      
      // Update stats
      document.getElementById("installedCount").textContent = installedApps.length;
      const totalSize = installedApps.reduce((sum, app) => {
        const size = parseFloat(app.size.replace(' MB', ''));
        return sum + size;
      }, 0);
      document.getElementById("totalSize").textContent = `${totalSize.toFixed(1)} MB`;

      if (installedApps.length === 0) {
        container.style.display = 'none';
        noAppsMessage.style.display = 'block';
        return;
      }

      container.style.display = 'grid';
      noAppsMessage.style.display = 'none';
      container.innerHTML = "";

      installedApps.forEach((app, index) => {
        const appCard = document.createElement("div");
        appCard.className = "installed-app-card";
        appCard.innerHTML = `
          <input type="checkbox" class="app-checkbox" data-app="${app.name}" onchange="toggleAppSelection('${app.name}')">
          <div class="installed-app-info">
            <img src="${app.image}" alt="${app.name}" class="installed-app-icon">
            <div class="installed-app-details">
              <h3 class="installed-app-name">${app.name}</h3>
              <p class="installed-app-description">${app.description}</p>
              <div class="installed-app-meta">
                <span class="meta-item">
                  <span>üìÖ</span>
                  <span>Installed: ${app.installedDate}</span>
                </span>
                <span class="meta-item">
                  <span>üè∑Ô∏è</span>
                  <span>${app.category}</span>
                </span>
                <span class="meta-item">
                  <span>üì¶</span>
                  <span>v${app.version}</span>
                </span>
              </div>
            </div>
          </div>
          <div class="installed-app-actions">
            <button class="action-btn launch" onclick="launchApp('${app.name}')">Launch</button>
            <button class="action-btn" onclick="showAppDetail('${app.name}')">Details</button>
            <button class="action-btn uninstall" onclick="toggleApp('${app.name}')">Uninstall</button>
          </div>
          <div class="installed-app-size">${app.size}</div>
        `;
        container.appendChild(appCard);
      });
    }

    // Enhanced Robot Management with Multi-Robot Features
    function renderRobots() {
      const c = document.getElementById("robotList");
      c.innerHTML = "";
      
      userData.robots.forEach((r, i) => {
        const div = document.createElement("div");
        div.className = "robot-card";
        const isActive = Math.random() > 0.5;
        const statusClass = isActive ? "status-active" : "status-inactive";
        const statusText = isActive ? "Active" : "Inactive";
        const robotIcon = robotTypeIcons[r.type] || "ü§ñ";
        const isSyncReady = syncReadyRobots.has(i);
        
        div.innerHTML = `
          <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
            <input type="checkbox" data-robot-index="${i}" onchange="toggleRobotSelection(${i})" style="width: 18px; height: 18px;">
            <div class="robot-header" style="flex: 1; margin-bottom: 0;">
              <div class="robot-title">
                <span class="robot-type-icon">${robotIcon}</span>
                ${r.name || r.type + " Robot"}
              </div>
              <span class="status-badge ${statusClass}">${statusText}</span>
            </div>
          </div>
          <div class="robot-subtitle">
            <span><strong>Model:</strong> ${r.model}</span>
            <span><strong>IP:</strong> ${r.ip}</span>
            ${r.location ? `<span><strong>Location:</strong> ${r.location}</span>` : ''}
          </div>
          ${r.description ? `<div style="color: #666; font-size: 0.9em; margin-top: 8px;">${r.description}</div>` : ''}
          <div class="robot-actions-bar">
            <button class="btn-connect" onclick="connectToBot('${r.ip}')">üîå Connect</button>
            <button class="action-btn" onclick="showRobotDetail(${i})">View Details</button>
            <button class="btn-multi-sync ${isSyncReady ? 'sync-ready' : ''}" onclick="multiSyncRobot(${i})">
              ${isSyncReady ? '‚úÖ Sync Ready' : 'üîÑ Multi Sync'}
            </button>
          </div>
        `;
        c.appendChild(div);
      });
      
      updateMultiRobotPanel();
    }

    // Multi-Robot Functions
    function toggleRobotSelection(robotIndex) {
      const checkbox = document.querySelector(`input[data-robot-index="${robotIndex}"]`);
      if (checkbox.checked) {
        selectedRobots.add(robotIndex);
      } else {
        selectedRobots.delete(robotIndex);
      }
      updateMultiRobotPanel();
    }

    function updateMultiRobotPanel() {
      const panel = document.getElementById('multiRobotPanel');
      const selectedCount = selectedRobots.size;
      const syncReadyCount = Array.from(selectedRobots).filter(index => syncReadyRobots.has(index)).length;
      
      if (selectedCount >= 1) {
        panel.style.display = 'block';
        document.getElementById('selectedRobotCount').textContent = selectedCount;
        document.getElementById('syncReadyCount').textContent = syncReadyCount;
      } else {
        panel.style.display = 'none';
      }
    }

    function multiSyncRobot(robotIndex) {
      const robot = userData.robots[robotIndex];
      
      const confirmed = confirm(`Enable Multi Sync for ${robot.name || robot.type}?\n\nThis will prepare the robot for multi-robot coordination.`);
      
      if (confirmed) {
        fetch('/api/setup-multi-sync', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ 
            robot: robot,
            robotIndex: robotIndex
          })
        })
        .then(res => res.json())
        .then(data => {
          if (data.status) {
            alert(`‚úÖ ${data.status}`);
            syncReadyRobots.add(robotIndex);
            renderRobots();
          } else {
            alert(`‚ùå Error: ${data.error}`);
          }
        })
        .catch(err => {
          console.error('Multi-sync error:', err);
          alert('‚ùå Failed to setup multi-sync');
        });
      }
    }

    function launchMultiRobotSimulation() {
      if (selectedRobots.size < 1) {
        alert('Please select at least 1 robot for simulation');
        return;
      }
      
      const robots = Array.from(selectedRobots).map(index => userData.robots[index]);
      
      fetch('/api/launch_multi_robot', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ robots: robots })
      })
      .then(res => res.json())
      .then(data => {
        if (data.status) {
          alert(`‚úÖ ${data.status}`);
          if (selectedRobots.size >= 2) {
            showCoordinationTasks();
          }
        } else {
          alert(`‚ùå Error: ${data.error}`);
        }
      })
      .catch(err => {
        console.error('Multi-robot launch error:', err);
        alert('‚ùå Failed to launch multi-robot simulation');
      });
    }

    function showCoordinationTasks() {
      if (selectedRobots.size < 2) {
        alert('Need at least 2 robots for coordination tasks');
        return;
      }
      
      const robots = Array.from(selectedRobots).map(index => userData.robots[index]);
      document.getElementById('multiRobotTaskModal').style.display = 'flex';
      document.getElementById('taskRobotList').innerHTML = 
        robots.map(r => `<li>‚Ä¢ ${r.name} (${r.type})</li>`).join('');
    }

    function startCoordinatedTask() {
      const taskType = document.getElementById('taskTypeSelect').value;
      const robots = Array.from(selectedRobots).map(index => userData.robots[index]);
      
      fetch('/api/setup_robot_communication', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ 
          robots: robots,
          task_type: taskType
        })
      })
      .then(res => res.json())
      .then(data => {
        if (data.status) {
          alert(`‚úÖ ${data.status}`);
          document.getElementById('multiRobotTaskModal').style.display = 'none';
        } else {
          alert(`‚ùå Error: ${data.error}`);
        }
      })
      .catch(err => {
        console.error('Communication setup error:', err);
        alert('‚ùå Failed to setup robot communication');
      });
    }

    function clearRobotSelection() {
      selectedRobots.clear();
      document.querySelectorAll('input[data-robot-index]').forEach(cb => cb.checked = false);
      updateMultiRobotPanel();
    }

    function showRobotDetail(robotIndex) {
      currentRobotIndex = robotIndex;
      const robot = userData.robots[robotIndex];
      const isActive = Math.random() > 0.5;
      const statusClass = isActive ? "status-active" : "status-inactive";
      const statusText = isActive ? "Active" : "Inactive";
      const robotIcon = robotTypeIcons[robot.type] || "ü§ñ";
      
      document.getElementById("robotDetailName").innerHTML = `
        <span class="robot-type-icon" id="robotDetailIcon">${robotIcon}</span>
        <span>${robot.name || `${robot.type} Robot`}</span>
      `;
      document.getElementById("robotDetailType").innerText = robot.type;
      document.getElementById("robotDetailModel").innerText = robot.model;
      document.getElementById("robotDetailIP").innerText = robot.ip;
      
      const statusElement = document.getElementById("robotDetailStatus");
      statusElement.className = `status-badge ${statusClass}`;
      statusElement.innerText = statusText;
      
      const specsContainer = document.getElementById("robotSpecs");
      specsContainer.innerHTML = "";
      const specs = robotSpecs[robot.type] && robotSpecs[robot.type][robot.model];
      if (specs) {
        Object.entries(specs).forEach(([key, value]) => {
          const specDiv = document.createElement("div");
          specDiv.className = "spec-item";
          specDiv.innerHTML = `
            <div class="spec-label">${key.charAt(0).toUpperCase() + key.slice(1)}</div>
            <div class="spec-value">${value}</div>
          `;
          specsContainer.appendChild(specDiv);
        });
      }
      showView("robotDetail");
    }

    function showAddRobot() {
      selectedRobotType = '';
      document.querySelectorAll('.robot-type-card').forEach(card => card.classList.remove('active'));
      document.getElementById('robotFormContainer').classList.remove('active');
      document.getElementById("botName").value = "";
      document.getElementById("botIP").value = "";
      document.getElementById("botLocation").value = "";
      document.getElementById("botDescription").value = "";
      showView("addRobot");
    }

    function selectBotType(type) {
      selectedRobotType = type;
      
      // Update visual selection
      document.querySelectorAll('.robot-type-card').forEach(card => card.classList.remove('active'));
      event.currentTarget.classList.add('active');
      
      // Show and update form
      const formContainer = document.getElementById('robotFormContainer');
      formContainer.classList.add('active');
      
      const robotIcon = robotTypeIcons[type] || "ü§ñ";
      document.getElementById("robotFormIcon").textContent = robotIcon;
      document.getElementById("robotFormTitleText").textContent = `Configure ${type}`;
      
      const modelSelect = document.getElementById("botModel");
            modelSelect.innerHTML = `<option value="">-- Select Model --</option>`;
      modelOptions[type].forEach(opt => {
        const o = document.createElement("option");
        o.value = opt;
        o.textContent = opt;
        modelSelect.appendChild(o);
      });
    }

    function saveRobot() {
      const name = document.getElementById("botName").value.trim();
      const model = document.getElementById("botModel").value.trim();
      const ip = document.getElementById("botIP").value.trim();
      const location = document.getElementById("botLocation").value.trim();
      const description = document.getElementById("botDescription").value.trim();

      if (!selectedRobotType || !name || !model || !ip) {
        return alert("‚ùå Please select a robot type and fill in all required fields.");
      }

      const newRobot = {
        type: selectedRobotType,
        name,
        model,
        ip,
        location,
        description
      };
      userData.robots.push(newRobot);
      updateUserData();
      alert("‚úÖ Robot added successfully!");
      showView("robot");
    }

    function filterInstalledApps() {
      const searchTerm = document.getElementById("searchInstalled").value.toLowerCase();
      const categoryFilter = document.getElementById("categoryFilter").value;
      const appCards = document.querySelectorAll(".installed-app-card");

      appCards.forEach(card => {
        const appName = card.querySelector(".installed-app-name").textContent.toLowerCase();
        const appCategory = card.querySelector(".installed-app-meta .meta-item:nth-child(2) span:last-child").textContent;

        const matchesSearch = appName.includes(searchTerm);
        const matchesCategory = !categoryFilter || appCategory === categoryFilter;

        card.style.display = (matchesSearch && matchesCategory) ? 'grid' : 'none';
      });
    }

    function toggleAppSelection(appName) {
      if (selectedApps.has(appName)) {
        selectedApps.delete(appName);
      } else {
        selectedApps.add(appName);
      }
    }

    function selectAllApps() {
      const checkboxes = document.querySelectorAll(".app-checkbox");
      const allSelected = Array.from(checkboxes).every(cb => cb.checked);

      checkboxes.forEach(cb => {
        cb.checked = !allSelected;
        const appName = cb.dataset.app;
        if (!allSelected) {
          selectedApps.add(appName);
        } else {
          selectedApps.delete(appName);
        }
      });
    }

    function uninstallSelected() {
      if (selectedApps.size === 0) {
        alert("No apps selected for uninstallation.");
        return;
      }

      const appList = Array.from(selectedApps).join(", ");
      if (confirm(`Are you sure you want to uninstall ${selectedApps.size} selected app(s)?\n\n${appList}`)) {
        selectedApps.forEach(appName => {
          const index = userData.apps.indexOf(appName);
          if (index > -1) {
            userData.apps.splice(index, 1);
          }
        });

        selectedApps.clear();
        updateUserData();
        renderInstalled();
      }
    }

    function launchApp(appName) {
      alert(`üöÄ Launching ${appName}...`);
    }

    function showAppDetail(appName) {
      const appIndex = tools.findIndex(tool => tool.name === appName);
      if (appIndex >= 0) {
        showDetail(appIndex);
      }
    }

    function showDetail(i) {
      const tool = tools[i];
      const installed = userData.apps.includes(tool.name);

      document.getElementById("detailImage").src = tool.image;
      document.getElementById("detailTitle").innerText = tool.name;
      document.getElementById("detailSubtitle").innerText = tool.description;
      document.getElementById("detailDescription").innerText = tool.detailedDescription;
      document.getElementById("detailStars").innerText = tool.rating;
      document.getElementById("detailRating").innerText = tool.ratingText;
      document.getElementById("detailDeveloper").innerText = tool.developer;

      const featuresList = document.getElementById("detailFeatures");
      featuresList.innerHTML = "";
      tool.features.forEach(feature => {
        const li = document.createElement("li");
        li.innerText = feature;
        featuresList.appendChild(li);
      });

      const screenshotGrid = document.getElementById("detailScreenshots");
      screenshotGrid.innerHTML = "";
      tool.screenshots.forEach(screenshot => {
        const img = document.createElement("img");
        img.src = screenshot;
        img.className = "screenshot";
        img.alt = "App Screenshot";
        screenshotGrid.appendChild(img);
      });

      document.getElementById("detailVersion").innerText = tool.version;
      document.getElementById("detailSize").innerText = tool.size;
      document.getElementById("detailCategory").innerText = tool.category;
      document.getElementById("detailLicense").innerText = "MIT";
      document.getElementById("detailUpdated").innerText = tool.updated;
      document.getElementById("detailDownloads").innerText = tool.downloads;

      const btn = document.getElementById("installBtn");
      btn.innerText = installed ? "Uninstall" : "Install";
      btn.className = installed ? "install-btn uninstall" : "install-btn";
      btn.onclick = () => { toggleApp(tool.name); showDetail(i); };

      showView("appDetail");
    }

    function toggleApp(name) {
  const index = userData.apps.indexOf(name);
  
  if (index >= 0) {
    userData.apps.splice(index, 1);
    alert(`‚úÖ ${name} uninstalled`);
  } else {
    // ========== SHAPE DRAWER HANDLER ==========
    if (name === "Shape Drawer") {
      const btn = event.target;
      const originalText = btn.textContent;
      
      (async () => {
        try {
          btn.textContent = "Installing...";
          btn.disabled = true;
          
          const shapeApps = [
            { script_url: "https://raw.githubusercontent.com/Axiom-Robotics/robot-apps/main/apps/turtlebot3/shapes/draw_square.py", script_filename: "draw_square.py", commands: ["square"], category: "shapes", robot_type: "turtlebot3" },
            { script_url: "https://raw.githubusercontent.com/Axiom-Robotics/robot-apps/main/apps/turtlebot3/shapes/draw_rectangle.py", script_filename: "draw_rectangle.py", commands: ["rectangle"], category: "shapes", robot_type: "turtlebot3" },
            { script_url: "https://raw.githubusercontent.com/Axiom-Robotics/robot-apps/main/apps/turtlebot3/shapes/draw_circle.py", script_filename: "draw_circle.py", commands: ["circle"], category: "shapes", robot_type: "turtlebot3" },
            { script_url: "https://raw.githubusercontent.com/Axiom-Robotics/robot-apps/main/apps/turtlebot3/shapes/draw_triangle.py", script_filename: "draw_triangle.py", commands: ["triangle"], category: "shapes", robot_type: "turtlebot3" }
          ];
          
          let installedCommands = [];
          for (const shape of shapeApps) {
            const response = await fetch(`${LOCAL_INSTALLER_URL}/install`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(shape) });
            const result = await response.json();
            if (result.success) installedCommands.push(...result.commands_added);
          }
          
          userData.apps.push(name);
          alert(`‚úÖ Shape Drawer installed!\n\nCommands: ${installedCommands.join(', ')}\n\nSaved to: ~/axiom_robot/installed_apps/turtlebot3/shapes/`);
          btn.textContent = "Installed";
          btn.disabled = false;
        } catch (error) {
          alert(`‚ùå Failed: ${error.message}`);
          btn.textContent = originalText;
          btn.disabled = false;
        }
      })();
    } 
    // ========== DANCE BOT HANDLER ==========
    else if (name === "Dance Bot") {
      const btn = event.target;
      const originalText = btn.textContent;
      
      (async () => {
        try {
          btn.textContent = "Installing...";
          btn.disabled = true;
          
          const danceApp = {
            script_url: "https://raw.githubusercontent.com/Axiom-Robotics/robot-apps/main/apps/turtlebot3/entertainment/dance_routine.py",
            script_filename: "dance_routine.py",
            commands: ["dance"],
            category: "entertainment",
            robot_type: "turtlebot3"
          };
          
          const response = await fetch(`${LOCAL_INSTALLER_URL}/install`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(danceApp) });
          const result = await response.json();
          
          if (result.success) {
            userData.apps.push(name);
            alert(`‚úÖ Dance Bot installed!\n\nCommand: dance\n\nTry: "do a dance" or "perform a dance routine"`);
            btn.textContent = "Installed";
          } else {
            throw new Error(result.error || "Installation failed");
          }
          btn.disabled = false;
        } catch (error) {
          alert(`‚ùå Failed: ${error.message}`);
          btn.textContent = originalText;
          btn.disabled = false;
        }
      })();
    }
    
    else if (name === "Delivery Bot") {
    const btn = event.target;
    const originalText = btn.textContent;
    
    (async () => {
        try {
            btn.textContent = "Installing...";
            btn.disabled = true;
            
            const deliveryApp = {
                script_url: "https://raw.githubusercontent.com/Axiom-Robotics/robot-apps/main/apps/turtlebot3/logistics/delivery_route.py",
                script_filename: "delivery_route.py",
                commands: ["delivery run", "start delivery", "courier mode"],
                category: "logistics",
                robot_type: "turtlebot3"
            };
            
            const response = await fetch(`${LOCAL_INSTALLER_URL}/install`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(deliveryApp)
            });
            
            const result = await response.json();
            
            if (result.success) {
                userData.apps.push(name);
                alert(`‚úÖ Delivery Bot installed!\n\nCommands: ${result.commands_added.join(', ')}\n\nSaved to: ${result.saved_to}\n\nTry: "start delivery" or "delivery run"`);
                btn.textContent = "Installed";
            } else {
                throw new Error(result.error || "Installation failed");
            }
            
            btn.disabled = false;
        } catch (error) {
            alert(`‚ùå Failed: ${error.message}`);
            btn.textContent = originalText;
            btn.disabled = false;
        }
    })();
}
    
    
    
    
    
    
    // ========== PATROLLING APP HANDLER (NEW!) ========== 
    
    else if (name === "Patrolling") {
     const btn = event.target;
     const originalText = btn.textContent;

     (async () => {
       try {
         btn.textContent = "Installing...";
         btn.disabled = true;
         
         
         const patrolApp = {
           script_url: "https://raw.githubusercontent.com/Axiom-Robotics/robot-apps/main/apps/turtlebot3/patrol/patrol_announce.py",
           script_filename: "patrol_announce.py",
           commands: ["patrol", "start patrol", "security patrol", "waypoint patrol"],
           category: "patrol",
           robot_type: "turtlebot3"
         };
        
          const response = await fetch(`${LOCAL_INSTALLER_URL}/install`, { 
            method: 'POST', 
            headers: { 'Content-Type': 'application/json' }, 
            body: JSON.stringify(patrolApp) 
          });
          
          const result = await response.json();
          
          if (result.success) {
            userData.apps.push(name);
            alert(`‚úÖ Patrolling app installed!\n\nCommands: ${result.commands_added.join(', ')}\n\nSaved to: ${result.saved_to}\n\nTry: "start patrol" or "begin security patrol"`);
            btn.textContent = "Installed";
          } else {
            throw new Error(result.error || "Installation failed");
          }
          
          btn.disabled = false;
        } catch (error) {
          alert(`‚ùå Failed: ${error.message}`);
          btn.textContent = originalText;
          btn.disabled = false;
        }
      })();
    }        
        
    else {
      userData.apps.push(name);
    }
  }
  updateUserData();
}


    function updateUserData() {
      fetch("/update-user", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ email: userEmail, apps: userData.apps, robots: userData.robots })
      }).then(() => {
        renderInstalled();
      });
    }

    // SSH connection function (unchanged)
    function connectToBot(robotIP) {
      const connectBtn = event.target;
      const originalText = connectBtn.textContent;
      connectBtn.textContent = "üîÑ Connecting...";
      connectBtn.disabled = true;

      fetch("/connect-bot", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ ip: robotIP })
      })
      .then(res => res.json())
      .then(data => {
        if (data.status === 'connected') {
          alert("‚úÖ Connected successfully to robot!");
          connectBtn.textContent = "üîå Connected";
          connectBtn.style.background = "#28a745";
        } else if (data.status === 'password_required') {
          const password = prompt(`Enter password for pi@${robotIP}:`);
          if (password) {
            fetch("/connect-bot-password", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ ip: robotIP, password: password })
            })
            .then(res => res.json())
            .then(data => {
              if (data.status === 'connected') {
                alert("‚úÖ Connected successfully to robot! Terminal window opening...");
                connectBtn.textContent = "üîå Connected";
                connectBtn.style.background = "#28a745";
              } else {
                alert("‚ùå Can't find robot like that");
                connectBtn.textContent = originalText;
                connectBtn.disabled = false;
              }
            });
          } else {
            connectBtn.textContent = originalText;
            connectBtn.disabled = false;
          }
        } else {
          alert("‚ùå Can't find robot like that");
          connectBtn.textContent = originalText;
          connectBtn.disabled = false;
        }
      })
      .catch(() => {
        alert("‚ùå Can't find robot like that");
        connectBtn.textContent = originalText;
        connectBtn.disabled = false;
      });
    }

    function launchInGazebo() {
      if (currentRobotIndex >= 0) {
        const robot = userData.robots[currentRobotIndex];
        fetch("http://localhost:5000/launch-gazebo", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ 
              type: robot.type,
              model: robot.model
          })
        })
        .then(res => res.json())
        .then(data => {
          if (data.status) {
            alert(`‚úÖ ${data.status}`);
          } else {
            alert(`‚ùå Error: ${data.error || "Failed to launch Gazebo"}`);
          }
        })
        .catch(err => {
          console.error("Launch error:", err);
          alert("‚ùå Could not launch Gazebo. See console for details.");
        });
      }
    }

    function deleteRobot() {
      if (currentRobotIndex >= 0) {
        const robot = userData.robots[currentRobotIndex];
        if (confirm(`Are you sure you want to delete ${robot.name || robot.type}?`)) {
          userData.robots.splice(currentRobotIndex, 1);
          fetch("/update-user", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ email: userEmail, apps: userData.apps, robots: userData.robots })
          }).then(() => {
            currentRobotIndex = -1;
            showView("robot");
          });
        }
      }
    }

    function showLogin() {
      document.getElementById("loginModal").style.display = "flex";
      document.getElementById("email").value = "";
      document.getElementById("password").value = "";
    }
    function closeLogin() {
      document.getElementById("loginModal").style.display = "none";
    }
    function login() {
      const email = document.getElementById("email").value.trim();
      const password = document.getElementById("password").value.trim();
      if (!email || !password) return alert("‚ùå Please enter email and password.");
      userEmail = email;
      fetch("/user-data", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ email })
      })
        .then(res => res.json())
        .then(data => {
          userData = data;
          document.getElementById("authArea").innerHTML = `
            <div class="user-dropdown">
              <div class="user-label">${userEmail}</div>
              <div class="dropdown-content"><div onclick="doLogout()">Logout</div></div>
            </div>`;
          closeLogin();
          showView("explore");
        });
    }
    function doLogout() {
      userEmail = null;
      userData = { apps: [], robots: [] };
      document.getElementById("authArea").innerHTML = `<button class="signin-btn" onclick="showLogin()">Sign In</button>`;
      showView("explore");
    }
    showView("explore");
  </script>
<!-- Multi-Robot Task Modal -->
<div id="multiRobotTaskModal" class="modal-overlay" style="display: none;">
  <div class="modal" style="width: 500px;">
    <button class="modal-close" onclick="document.getElementById('multiRobotTaskModal').style.display='none'">√ó</button>
    
    <div style="padding: 30px;">
      <h2>ü§ñ Multi-Robot Coordination</h2>
      <p>Assign specific tasks to each robot based on its capabilities:</p>
      
      <div id="taskAssignmentList" style="margin: 20px 0;">
        <!-- Robot task dropdowns will be generated here dynamically -->
      </div>
      
      <div style="display: flex; gap: 15px; justify-content: center; margin-top: 30px;">
        <button class="btn-primary" onclick="startCollaborativeTasks()">Start Collaborative Tasks</button>
        <button class="btn-secondary" onclick="document.getElementById('multiRobotTaskModal').style.display='none'">Cancel</button>
      </div>
    </div>
  </div>
</div>
<script>
let selectedRobots = [
    { name: "manipulator", type: "Manipulator" },
    { name: "turtle", type: "TurtleBot3" }
]; // Store selected robots

// Called when clicking "Setup Tasks"
function showCoordinationTasks() {
    const panel = document.getElementById("multiRobotTaskModal");
    const container = document.getElementById("taskAssignmentList");
    container.innerHTML = "";

    // Example selected robots (replace with actual selected ones from your app)
    // selectedRobots = [ { name: "manipulator", type: "Manipulator" }, { name: "turtle", type: "TurtleBot3" } ];

    selectedRobots.forEach(robot => {
        let capabilities = [];
        if (robot.type === "Manipulator") {
            capabilities = ["pickup_object", "place_object", "assembly_task"];
        } else if (robot.type === "TurtleBot3") {
            capabilities = ["mapping", "patrol", "follow_path"];
        }

        let div = document.createElement("div");
        div.innerHTML = `
            <label><strong>${robot.name} (${robot.type})</strong></label>
            <select class="robot-task-select" data-robot="${robot.name}" style="width: 100%; padding: 8px; margin-top: 5px;">
                ${capabilities.map(cap => `<option value="${cap}">${cap.replace(/_/g, " ")}</option>`).join("")}
            </select>
        `;
        container.appendChild(div);
    });

    panel.style.display = "block";
}

// Send tasks to backend
function startCollaborativeTasks() {
    let tasks = {};
    document.querySelectorAll(".robot-task-select").forEach(select => {
        tasks[select.getAttribute("data-robot")] = select.value;
    });

    fetch("/api/assign_tasks", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ tasks: tasks })
    })
    .then(res => res.json())
    .then(data => {
        alert(data.status || data.error);
        document.getElementById("multiRobotTaskModal").style.display = "none";
    })
    .catch(err => {
        alert("Error sending tasks");
        console.error(err);
    });
}
</script>

</body>
</html>


